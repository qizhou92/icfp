% give the real meat of the thing
\section{Technical Approach}
%
In this section, we describe our technical approach in detail.
%
In \autoref{sec:rel-invs}, we define the class of proof
structures synthesized by \sys.
%
In \autoref{sec:verifier}, we present the verification algorithm used
by \sys to synthesize such structures.

\subsection{Relational invariants as equivalence proofs}
\label{sec:rel-invs}
%
\sys, given programs $P_0$ and $P_1$, attempts to synthesize a proof
that $P_0$ is equivalent to $P_1$ that is represented as a set of
subexpressions of $P_0$ and $P_1$, mapped to a relational invariant
over the subexpressions.
%
For the rest of this section, let $P_0, P_1 \in \stlc$ be two fixed,
arbitrary $\stlc$ programs.
%
For $e \in \expr$, let $\symvars{e}$ denote a disjoint copy of
$\freevars(e)$.
%
For expressions $E \subseteq \expr$, let $\symvars{E} = \bigunion_{e
  \in E} \symvars{e}$.

% define symbolic relations:
\begin{defn}
  \label{defn:sym-rels}
  Let $E = \subexps(P_0) \union \subexps(P_1)$,
  %
  $R: \pset(E) \to \formulas{ \symvars{E} }$ be such that %
  for each $E_0 \subseteq E$, %
  it holds that $R(E_0) \in \formulas{ \symvars{E_0} }$.
  %
  Then $R$ are \emph{symbolic relations}.
\end{defn}
%
The space of symbolic relations is denoted $\symrels$.

% define relational invariants
\begin{defn}
  \label{defn:rel-invs}
  For $P_0, P_1 \in \stlc$, let $R \in \symrels$ be such that %
  for each $E \subseteq \subexps(P_0) \union \subexps(P_1)$, either %
  \textbf{(1)} there is some $e \in E \intersection \subexps(P_0)$
  such that for all $e_0, \ldots, e_n \in \subexps(P_0)$ such that %
  $[ e_0, \ldots, e_n ] \stepsto{P_0} e$, 
  % relational invariants of E with e removed and preds added,
  \[ R( (\remove{ E }{ e }) \union \elts{ e_0, \ldots e_n } ),
  % and symbolic relation of the step to e entail
  \symstep{ e_0, \ldots, e_n }{ e } \entails
  % symbolic relation of E:
  R(E)
  \] or % symmetric condition for P1
  \textbf{(2)} there is some $e \in E \intersection \subexps(P_1)$
  such that for all $e_0, \ldots, e_n \in \subexps(P_1)$ such that %
  $[ e_0, \ldots, e_n ] \stepsto{P_1} e$,
  % relational invariants of E with e removed and preds added,
  \[ R( (\remove{ E }{ e }) \union \elts{ e_0, \ldots e_n } ),
  % and symbolic relation of the step to e entail
  \symstep{ e_0, \ldots, e_n }{ e } \entails
  % symbolic relation of E:
  R(E)
  \]
  %
  Then $R$ are \emph{relational invariants}.
\end{defn}
%
The space of relational invariants is denoted $\relinvs$.

% relational invariants
Relational invariants are evidence of partial equivalence if they are
supported by the assumption that $P_0$ and $P_1$ are run on equal
inputs, and they imply that $P_0$ and $P_1$ return equal values.
%
\begin{defn}
  \label{defn:eq-pf}
  Let $R \in \relinvs$ be such that $R(P_0, P_1), \alpha^0_0 =
  \alpha^1_0 \entails \nu^0 = \nu^1$.
  %
  Then $R$ is \emph{evidence} of $P_0 \equiv P_1$.
\end{defn}

% example of relational invariants:
\begin{ex}
  \label{ex:rel-invs}
  \BH{give example relational invariants}
\end{ex}

% evidence is a valid proof of partial equivalence:
If there is evidence of the equivalence of $P_0$ and $P_1$, then $P_0
\equiv P_1$.
%
\begin{lemma}
  \label{lemma:valid-evidence}
  If there is some $R \in \relinvs$ such that $R$ is evidence of $P_0
  \equiv P_1$, then $P_0 \equiv P_1$.
\end{lemma}

\subsection{An automatic equivalence verifier}
\label{sec:verifier}
%
\BH{define equivalence verifier. Maintains relational invariants over
  sets of derivations.}

\BH{derivation refutation: define relational invariants over sets of
  subderivations that form a frontier in the pair of
  derivations. Start from the set of all leaves. Get the relational
  invariant for each set by taking disjunction over its predecessors
  along every step, and then some context formula that will be
  non-trivial to define.}

\BH{after solving for relational invariants over sets of derivations,
  some derivations may occur more than once in a pair of
  derivations. The invariants for these get folded together using
  conjunction. This normalizes the result into a relational invariant
  per set of derivation}

\BH{sets of derivations play the role of sets of paths in path-based
  analysis. Entailment is checked over sets derivations that derive
  the same set of expressions. Search for a sufficient set can branch:
  we just need to find an inductive set along some expression.}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "p"
%%% End: 
